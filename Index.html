<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProPad Remote</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --bg-color: #121214; --card-bg: #1a1a1c; --accent-yellow: #f5a623;
            --text-main: #ffffff; --text-dim: #8e8e93; --guide-color: rgba(245, 166, 35, 0.15);
        }
        body, html { margin: 0; font-family: -apple-system, sans-serif; background-color: var(--bg-color); color: var(--text-main); height: 100vh; overflow: hidden; }
        
        /* Dashboard */
        #dashboard { display: flex; flex-direction: column; height: 100%; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; border-bottom: 1px solid #222; }
        .logo-box { background: var(--accent-yellow); width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: black; font-size: 22px; }
        .start-btn { background: var(--accent-yellow); color: black; border: none; padding: 12px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; }
        main { display: flex; gap: 20px; padding: 20px 40px; height: calc(100vh - 120px); }
        .editor-container { flex: 2; display: flex; flex-direction: column; }
        textarea { flex: 1; background: var(--card-bg); border: 1px solid #333; border-radius: 20px; padding: 25px; color: white; font-size: 18px; outline: none; }
        .sidebar { flex: 1; background: var(--card-bg); border-radius: 20px; padding: 25px; display: flex; flex-direction: column; gap: 20px; border: 1px solid #333; }
        
        /* Remote Control View */
        #remote-view { display: none; height: 100vh; flex-direction: column; align-items: center; justify-content: center; gap: 30px; padding: 40px; background: #000; }
        .remote-btn { width: 100%; max-width: 300px; height: 100px; border-radius: 20px; font-size: 24px; font-weight: bold; border: none; cursor: pointer; }
        .btn-start { background: var(--accent-yellow); color: black; }
        .btn-pause { background: #333; color: white; border: 2px solid var(--accent-yellow); }
        .btn-exit { background: #800; color: white; }

        /* Prompter Engine */
        #prompter-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 1000; overflow: hidden; }
        #scrolling-content { position: absolute; top: 100%; left: 0; width: 100%; will-change: transform; white-space: pre-wrap; transition: none; }
        #reading-guide { position: fixed; top: 40%; left: 0; width: 100%; height: 90px; background: var(--guide-color); border-top: 1px solid var(--accent-yellow); border-bottom: 1px solid var(--accent-yellow); z-index: 1001; pointer-events: none; }
    </style>
</head>
<body onload="initApp()">

<div id="dashboard">
    <header>
        <div style="display:flex; align-items:center; gap:15px;"><div class="logo-box">üé¨</div><h1>ProPad</h1></div>
        <button class="start-btn" onclick="runPrompter()">‚ñ∂ START</button>
    </header>
    <main>
        <div class="editor-container"><textarea id="scriptInput" oninput="saveData()">Paste script here...</textarea></div>
        <div class="sidebar">
            <div style="background:#000; padding:15px; border-radius:10px; border:1px dashed var(--accent-yellow);">
                <strong>REMOTE SETUP</strong><br>
                iPad ID: <span id="my-id" style="color:white; font-weight:bold;">...</span><br>
                <input type="text" id="remote-id-input" placeholder="Enter iPad ID on iPhone" style="width:100%; margin:10px 0; padding:8px; border-radius:5px; border:none;">
                <button onclick="connectAsRemote()" style="width:100%; background:var(--accent-yellow); border:none; padding:10px; border-radius:5px; font-weight:bold;">Connect iPhone as Remote</button>
            </div>
            <p style="font-size:12px; color:var(--text-dim)">Speed (WPM): <span id="speedVal" style="color:var(--accent-yellow)">140</span></p>
            <input type="range" id="speed" min="50" max="300" value="140" oninput="document.getElementById('speedVal').innerText=this.value; saveData();" style="width:100%">
        </div>
    </main>
</div>

<div id="remote-view">
    <h2 id="remote-status" style="color:var(--accent-yellow)">CONTROLLING IPAD</h2>
    <button class="remote-btn btn-start" onclick="sendCommand('START')">‚ñ∂ START PROMPTER</button>
    <button class="remote-btn btn-pause" onclick="sendCommand('PAUSE')">‚è∏ PAUSE / RESUME</button>
    <button class="remote-btn btn-exit" onclick="sendCommand('EXIT')">‚úñ EXIT TO EDITOR</button>
</div>

<div id="prompter-view" onclick="togglePause()">
    <div id="reading-guide"></div>
    <div id="scrolling-content"></div>
</div>

<script>
    let peer, conn, animationId, currentY = 0, isPaused = false;

    function initApp() {
        const saved = JSON.parse(localStorage.getItem('propad_data') || '{}');
        if (saved.text) document.getElementById('scriptInput').value = saved.text;
        
        peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', c => {
            conn = c;
            document.getElementById('my-id').innerText = "CONNECTED";
            conn.on('data', data => handleCommand(data));
        });
    }

    function connectAsRemote() {
        const targetId = document.getElementById('remote-id-input').value;
        conn = peer.connect(targetId);
        conn.on('open', () => {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('remote-view').style.display = 'flex';
        });
    }

    function sendCommand(cmd) { if (conn) conn.send(cmd); }

    function handleCommand(cmd) {
        if (cmd === 'START') runPrompter();
        if (cmd === 'PAUSE') togglePause();
        if (cmd === 'EXIT') exitPrompter();
    }

    function runPrompter() {
        const content = document.getElementById('scrolling-content');
        content.innerText = document.getElementById('scriptInput').value;
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('prompter-view').style.display = 'block';
        currentY = window.innerHeight * 0.4;
        content.style.transform = `translateY(${currentY}px)`;
        isPaused = false;
        startScrolling();
    }

    function startScrolling() {
        if (isPaused) return;
        const speed = (document.getElementById('speed').value / 140) * 2.5;
        function step() {
            if (!isPaused) {
                currentY -= speed;
                document.getElementById('scrolling-content').style.transform = `translateY(${currentY}px)`;
            }
            if (currentY > -document.getElementById('scrolling-content').offsetHeight) animationId = requestAnimationFrame(step);
        }
        animationId = requestAnimationFrame(step);
    }

    function togglePause() { isPaused = !isPaused; if(!isPaused) startScrolling(); }
    function exitPrompter() { cancelAnimationFrame(animationId); document.getElementById('prompter-view').style.display = 'none'; document.getElementById('dashboard').style.display = 'flex'; }
    function saveData() { localStorage.setItem('propad_data', JSON.stringify({text: document.getElementById('scriptInput').value})); }
</script>
</body>
</html>
